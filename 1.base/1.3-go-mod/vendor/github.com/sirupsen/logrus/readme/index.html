<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Logrus   #  Logrus is a structured logger for Go (golang), completely API compatible with the standard library logger.
Logrus is in maintenance-mode. We will not be introducing new features. It&rsquo;s simply too hard to do in a way that won&rsquo;t break many people&rsquo;s projects, which is the last thing you want from your Logging library (again&mldr;).
This does not mean Logrus is dead. Logrus will continue to be maintained for security, (backwards compatible) bug fixes, and performance (where we are limited by the interface)."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content><meta property="og:description" content="Logrus   #  Logrus is a structured logger for Go (golang), completely API compatible with the standard library logger.
Logrus is in maintenance-mode. We will not be introducing new features. It&rsquo;s simply too hard to do in a way that won&rsquo;t break many people&rsquo;s projects, which is the last thing you want from your Logging library (again&mldr;).
This does not mean Logrus is dead. Logrus will continue to be maintained for security, (backwards compatible) bug fixes, and performance (where we are limited by the interface)."><meta property="og:type" content="article"><meta property="og:url" content="https://golang.coding3min.com/1.base/1.3-go-mod/vendor/github.com/sirupsen/logrus/readme/"><meta property="article:section" content="1.base"><title>Readme | Go语言精进之路</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.958cea7827621d6fbcb3acf091344c3e44e3d2a9428f9c3c38bb9eb37bf8c45d.css integrity="sha256-lYzqeCdiHW+8s6zwkTRMPkTj0qlCj5w8OLues3v4xF0=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script><script defer src=/en.search.min.8540c7f1ba53902c127e1f7d81211e9b498d21de64f678212e72384efa8e27bf.js integrity="sha256-hUDH8bpTkCwSfh99gSEem0mNId5k9nghLnI4TvqOJ78=" crossorigin=anonymous></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a href=/><img src=/logo.png alt=Logo><span>Go语言精进之路</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://coding3min.com>机智的程序员小熊</a></li><li><a href=https://github.com/minibear2333/>GitHub</a></li><li><a href=/qrcode/>微信公众号</a></li><li><strong>帮助与提示</strong><ul><li><a href=/howtocontribute/>0.0 如何参与贡献</a></li><li><a href=/books-share/>0.1 书籍推荐</a></li></ul></li><li><strong>————基础篇————</strong></li><li><strong>第一章、Go基础</strong><ul><li><a href=/1.base/1-1-install-download/>1.1 安装与下载</a></li><li><a href=/1.base/1-2-hello-world/>1.2 跑起来</a></li><li><a href=/1.base/1-3-go-mod/>1.3 go mod最佳实践</a></li><li><a href=/1.base/1-4-variables/>1.4 变量与常量</a></li><li><a href=/1.base/1-5-switch%E5%92%8Ctypeswitch/>1.5 switch和type switch</a></li><li><a href=/1.base/1-6-for-range/>1.6 循环</a></li><li><a href=/1.base/1-7-range%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/>1.7 range深度解析</a></li></ul></li><li><strong>第二章、函数和容器</strong><ul><li><a href=/2.func-containers/2-1-func/>2.1 函数简单使用和基本知识解析</a></li><li><a href=/2.func-containers/2-2-%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0%E5%92%8C%E9%97%AD%E5%8C%85/>2.2 匿名函数和闭包</a></li><li><a href=/2.func-containers/2-3-%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0/>2.3 可变参数</a></li><li><a href=/2.func-containers/2-4-map/>2.4 集合（map）</a></li><li><a href=/2.func-containers/2-5-%E6%95%B0%E7%BB%84%E5%92%8C%E5%88%87%E7%89%87/>2.5 数组和切片</a></li></ul></li><li><strong>第三章、语法进阶</strong><ul><li><a href=/3.grammar-advancement/3-1-point/>3.1 指针讨论</a></li><li><a href=/3.grammar-advancement/3-2-struct/>3.2 结构体</a></li><li><a href=/3.grammar-advancement/3-3-%E6%8E%A5%E5%8F%A3%E4%B8%8E%E5%A4%9A%E6%80%81/>3.3 接口与多态</a></li><li><a href=/3.grammar-advancement/3-4-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/>3.4 异常处理</a></li><li>-反射 TODO</li></ul></li><li><strong>第四章、并发和并行</strong><ul><li><a href=/4.concurrent/4-1-go%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84%E5%B9%B6%E5%8F%91%E7%89%B9%E6%80%A7/>4.1 并发特性</a></li><li><a href=/4.concurrent/4-2-goroutine-wait/>4.2 并发等待</a></li><li><a href=/4.concurrent/4-3-channel/>4.3 channel</a></li><li><a href=/4.concurrent/4-4-deadlock/>4.4 deadlock</a></li><li><a href=/4.concurrent/4-5-select/>4.5 select</a></li><li><a href=/4.concurrent/4-6-cron/>4.6 定时器</a></li><li>-并发安全和锁</li><li>-原子操作 TODO</li><li>-协程池 TODO</li><li>-消费者生产者框架 TODO</li><li>-GMP调度原理 TODO</li></ul></li><li><strong>————框架篇————</strong></li><li><strong>第五章、常用标准库</strong><ul><li><a href=5.standard-library/5.1-Go%e4%bb%a3%e7%a0%81%e5%9f%ba%e6%9c%ac%e6%a0%87%e5%87%86%e8%a7%84%e8%8c%83>5.1 Go代码基本标准规范</a></li><li><a href=5.standard-library/5.2-json>5.2 json库</a></li><li><a href=5.standard-library/5.3-Go%e6%96%87%e4%bb%b6%e6%93%8d%e4%bd%9c%e5%a4%a7%e5%85%a8>5.3 文件操作</a></li><li><a href=/5.standard-library/%E5%88%87%E7%89%87%E6%8E%92%E5%BA%8Fsort%E5%8C%85%E7%9A%84%E4%BD%BF%E7%94%A8/>5.3 排序</a></li><li><a href=5.standard-library/flag%e5%8c%85%e8%af%bb%e5%8f%96%e5%91%bd%e4%bb%a4%e8%a1%8c%e9%85%8d%e7%bd%ae>5.4 命令行操作</a></li><li>-时间处理 TODO</li><li>-字符串处理 TODO</li><li>-跨平台编译 TODO</li><li>-模板 TODO</li><li>-在线工具系统实战 TODO</li></ul></li><li><strong>第x章、常用数据操作</strong><ul><li>-mysql</li><li>-redis</li><li>-mongo</li><li>-rabbitmq</li><li>-kafka</li><li>-etcd</li><li>-rabbitmq</li><li>-zookeeper</li><li>-ElasticSearch</li></ul></li><li><strong>第x章、常用第三方包</strong><ul><li>-日志</li><li>-配置管理</li><li>-接口文档</li><li>-错误码控制</li></ul></li><li><strong>————测试调试篇————</strong></li><li><strong>第x章、调试与测试</strong><ul><li><a href=https://mp.weixin.qq.com/s/ltRpuolYuOa8cXivLZLlUw>单元测试</a></li><li>-基准测试</li><li>-mock</li><li>-自动化测试</li><li>-调试</li></ul></li><li><strong>第x章、性能调优</strong><ul><li>-cpu调度</li><li>-内存管理</li><li>-垃圾回收</li><li>-PProf</li><li>-逃逸分析</li><li>-链路追踪</li></ul></li><li><strong>————网络编程篇————</strong></li><li><strong>第x章、HTTP框架</strong><ul><li>-http库实现GET POST PUT DEL请求</li><li>-websocket实现在线聊天室</li><li>-常用API框架</li><li>-gin框架实现SSO单点登陆系统</li><li>-beego实现博客</li><li>-buffalo实现变更发布系统</li><li>-echo实现工单管理系统</li><li>-Iris实现</li><li>-revel实现</li></ul></li><li><strong>第x章、RPC</strong></li><li><strong>第x章、微服务</strong><ul><li>熔断与限流</li></ul></li><li><strong>第x章、爬虫实战</strong></li><li><strong>第x章、分布式系统</strong><ul><li>-分布式ID生成器</li><li>-分布式锁</li><li>-分布式一致性算法</li><li>-分布式定时任务</li><li>-分布式计算</li></ul></li><li><strong>————工程化篇————</strong></li><li><strong>第x章、Go语言工程化实战</strong><ul><li>构建约束</li><li><a href=/%E5%B7%A5%E7%A8%8B%E5%8C%96%E5%AE%9E%E8%B7%B5/golang%E6%89%93%E9%95%9C%E5%83%8Fdockerfile%E7%9A%84%E5%86%99%E6%B3%95/>Go与Dockerfile</a></li></ul></li><li><strong>第x章、Go语言运维实战</strong></li><li><strong>第x章、Go语言监控实战</strong><ul><li>-自监控</li></ul></li><li><strong>————拓展学习————</strong></li><li><strong>第x章、kubernetes开发实战</strong></li><li><strong>第x章、服务治理</strong></li><li><strong>番外1、拓展应用</strong><ul><li><a href=/tools/readme/>小工具</a></li></ul></li><li><strong>番外2、陷阱与缺陷</strong><ul><li><a href=/impossible/range/readme/>range的第二个值实际上是值拷贝</a></li><li><a href=/impossible/%E6%96%B0%E6%89%8B%E5%B8%B8%E7%8A%AF%E7%9A%84%E9%94%99%E8%AF%AF/>新手常犯的错误</a></li><li><a href=/impossible/%E5%88%9D%E5%AD%A6%E8%80%85%E5%B8%B8%E7%8A%AF%E7%9A%84%E9%94%99%E8%AF%AF/>初学者常犯的错误</a></li><li><a href=/impossible/%E8%BF%9B%E9%98%B6%E5%B8%B8%E7%8A%AF%E7%9A%84%E9%94%99%E8%AF%AF/>进阶常犯的错误</a></li></ul></li><li><strong>第x章、GO语言版本分析</strong></li></ul></nav><script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Readme</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li></li></ul></li></ul></nav></aside></header><article class=markdown>Logrus
<a href=https://travis-ci.org/sirupsen/logrus><img src="https://travis-ci.org/sirupsen/logrus.svg?branch=master" alt="Build Status"></a><h1 id=logrus-img-srchttpiimgurcomhtevwmjpng-width40-height40-altwalrus-classemoji-titlewalrus-build-statushttpstravis-ciorgsirupsenlogrussvgbranchmasterhttpstravis-ciorgsirupsenlogrus-godochttpsgodocorggithubcomsirupsenlogrusstatussvghttpsgodocorggithubcomsirupsenlogrus><a href=https://godoc.org/github.com/sirupsen/logrus><img src=https://godoc.org/github.com/sirupsen/logrus?status.svg alt=GoDoc></a>
<a class=anchor href=#logrus-img-srchttpiimgurcomhtevwmjpng-width40-height40-altwalrus-classemoji-titlewalrus-build-statushttpstravis-ciorgsirupsenlogrussvgbranchmasterhttpstravis-ciorgsirupsenlogrus-godochttpsgodocorggithubcomsirupsenlogrusstatussvghttpsgodocorggithubcomsirupsenlogrus>#</a></h1><p>Logrus is a structured logger for Go (golang), completely API compatible with
the standard library logger.</p><p><strong>Logrus is in maintenance-mode.</strong> We will not be introducing new features. It&rsquo;s
simply too hard to do in a way that won&rsquo;t break many people&rsquo;s projects, which is
the last thing you want from your Logging library (again&mldr;).</p><p>This does not mean Logrus is dead. Logrus will continue to be maintained for
security, (backwards compatible) bug fixes, and performance (where we are
limited by the interface).</p><p>I believe Logrus' biggest contribution is to have played a part in today&rsquo;s
widespread use of structured logging in Golang. There doesn&rsquo;t seem to be a
reason to do a major, breaking iteration into Logrus V2, since the fantastic Go
community has built those independently. Many fantastic alternatives have sprung
up. Logrus would look like those, had it been re-designed with what we know
about structured logging in Go today. Check out, for example,
<a href=https://github.com/rs/zerolog>Zerolog</a>,
<a href=https://github.com/uber-go/zap>Zap</a>, and
<a href=https://github.com/apex/log>Apex</a>.</p><p><strong>Seeing weird case-sensitive problems?</strong> It&rsquo;s in the past been possible to
import Logrus as both upper- and lower-case. Due to the Go package environment,
this caused issues in the community and we needed a standard. Some environments
experienced problems with the upper-case variant, so the lower-case was decided.
Everything using <code>logrus</code> will need to use the lower-case:
<code>github.com/sirupsen/logrus</code>. Any package that isn&rsquo;t, should be changed.</p><p>To fix Glide, see
<a href=https://github.com/sirupsen/logrus/issues/553#issuecomment-306591437>these
comments</a>.
For an in-depth explanation of the casing issue, see
<a href=https://github.com/sirupsen/logrus/issues/570#issuecomment-313933276>this
comment</a>.</p><p>Nicely color-coded in development (when a TTY is attached, otherwise just
plain text):</p><p><img src=http://i.imgur.com/PY7qMwd.png alt=Colored></p><p>With <code>log.SetFormatter(&log.JSONFormatter{})</code>, for easy parsing by logstash
or Splunk:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{<span style=color:#f92672>&#34;animal&#34;</span>:<span style=color:#e6db74>&#34;walrus&#34;</span>,<span style=color:#f92672>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;info&#34;</span>,<span style=color:#f92672>&#34;msg&#34;</span>:<span style=color:#e6db74>&#34;A group of walrus emerges from the
</span><span style=color:#e6db74>ocean&#34;</span>,<span style=color:#f92672>&#34;size&#34;</span>:<span style=color:#ae81ff>10</span>,<span style=color:#f92672>&#34;time&#34;</span>:<span style=color:#e6db74>&#34;2014-03-10 19:57:38.562264131 -0400 EDT&#34;</span>}

{<span style=color:#f92672>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;warning&#34;</span>,<span style=color:#f92672>&#34;msg&#34;</span>:<span style=color:#e6db74>&#34;The group&#39;s number increased tremendously!&#34;</span>,
<span style=color:#f92672>&#34;number&#34;</span>:<span style=color:#ae81ff>122</span>,<span style=color:#f92672>&#34;omg&#34;</span>:<span style=color:#66d9ef>true</span>,<span style=color:#f92672>&#34;time&#34;</span>:<span style=color:#e6db74>&#34;2014-03-10 19:57:38.562471297 -0400 EDT&#34;</span>}

{<span style=color:#f92672>&#34;animal&#34;</span>:<span style=color:#e6db74>&#34;walrus&#34;</span>,<span style=color:#f92672>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;info&#34;</span>,<span style=color:#f92672>&#34;msg&#34;</span>:<span style=color:#e6db74>&#34;A giant walrus appears!&#34;</span>,
<span style=color:#f92672>&#34;size&#34;</span>:<span style=color:#ae81ff>10</span>,<span style=color:#f92672>&#34;time&#34;</span>:<span style=color:#e6db74>&#34;2014-03-10 19:57:38.562500591 -0400 EDT&#34;</span>}

{<span style=color:#f92672>&#34;animal&#34;</span>:<span style=color:#e6db74>&#34;walrus&#34;</span>,<span style=color:#f92672>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;info&#34;</span>,<span style=color:#f92672>&#34;msg&#34;</span>:<span style=color:#e6db74>&#34;Tremendously sized cow enters the ocean.&#34;</span>,
<span style=color:#f92672>&#34;size&#34;</span>:<span style=color:#ae81ff>9</span>,<span style=color:#f92672>&#34;time&#34;</span>:<span style=color:#e6db74>&#34;2014-03-10 19:57:38.562527896 -0400 EDT&#34;</span>}

{<span style=color:#f92672>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;fatal&#34;</span>,<span style=color:#f92672>&#34;msg&#34;</span>:<span style=color:#e6db74>&#34;The ice breaks!&#34;</span>,<span style=color:#f92672>&#34;number&#34;</span>:<span style=color:#ae81ff>100</span>,<span style=color:#f92672>&#34;omg&#34;</span>:<span style=color:#66d9ef>true</span>,
<span style=color:#f92672>&#34;time&#34;</span>:<span style=color:#e6db74>&#34;2014-03-10 19:57:38.562543128 -0400 EDT&#34;</span>}
</code></pre></div><p>With the default <code>log.SetFormatter(&log.TextFormatter{})</code> when a TTY is not
attached, the output is compatible with the
<a href=http://godoc.org/github.com/kr/logfmt>logfmt</a> format:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>time=&#34;2015-03-26T01:27:38-04:00&#34; level=debug msg=&#34;Started observing beach&#34; animal=walrus number=8
time=&#34;2015-03-26T01:27:38-04:00&#34; level=info msg=&#34;A group of walrus emerges from the ocean&#34; animal=walrus size=10
time=&#34;2015-03-26T01:27:38-04:00&#34; level=warning msg=&#34;The group&#39;s number increased tremendously!&#34; number=122 omg=true
time=&#34;2015-03-26T01:27:38-04:00&#34; level=debug msg=&#34;Temperature changes&#34; temperature=-4
time=&#34;2015-03-26T01:27:38-04:00&#34; level=panic msg=&#34;It&#39;s over 9000!&#34; animal=orca size=9009
time=&#34;2015-03-26T01:27:38-04:00&#34; level=fatal msg=&#34;The ice breaks!&#34; err=&amp;{0x2082280c0 map[animal:orca size:9009] 2015-03-26 01:27:38.441574009 -0400 EDT panic It&#39;s over 9000!} number=100 omg=true
</code></pre></div><p>To ensure this behaviour even if a TTY is attached, set your formatter as follows:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go>	<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>SetFormatter</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>TextFormatter</span>{
		<span style=color:#a6e22e>DisableColors</span>: <span style=color:#66d9ef>true</span>,
		<span style=color:#a6e22e>FullTimestamp</span>: <span style=color:#66d9ef>true</span>,
	})
</code></pre></div><h4 id=logging-method-name>Logging Method Name
<a class=anchor href=#logging-method-name>#</a></h4><p>If you wish to add the calling method as a field, instruct the logger via:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>SetReportCaller</span>(<span style=color:#66d9ef>true</span>)
</code></pre></div><p>This adds the caller as &lsquo;method&rsquo; like so:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{<span style=color:#f92672>&#34;animal&#34;</span>:<span style=color:#e6db74>&#34;penguin&#34;</span>,<span style=color:#f92672>&#34;level&#34;</span>:<span style=color:#e6db74>&#34;fatal&#34;</span>,<span style=color:#f92672>&#34;method&#34;</span>:<span style=color:#e6db74>&#34;github.com/sirupsen/arcticcreatures.migrate&#34;</span>,<span style=color:#f92672>&#34;msg&#34;</span>:<span style=color:#e6db74>&#34;a penguin swims by&#34;</span>,
<span style=color:#f92672>&#34;time&#34;</span>:<span style=color:#e6db74>&#34;2014-03-10 19:57:38.562543129 -0400 EDT&#34;</span>}
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>time=&#34;2015-03-26T01:27:38-04:00&#34; level=fatal method=github.com/sirupsen/arcticcreatures.migrate msg=&#34;a penguin swims by&#34; animal=penguin
</code></pre></div><p>Note that this does add measurable overhead - the cost will depend on the version of Go, but is
between 20 and 40% in recent tests with 1.6 and 1.7. You can validate this in your
environment via benchmarks:</p><pre><code>go test -bench=.*CallerTracing
</code></pre><h4 id=case-sensitivity>Case-sensitivity
<a class=anchor href=#case-sensitivity>#</a></h4><p>The organization&rsquo;s name was changed to lower-case&ndash;and this will not be changed
back. If you are getting import conflicts due to case sensitivity, please use
the lower-case import: <code>github.com/sirupsen/logrus</code>.</p><h4 id=example>Example
<a class=anchor href=#example>#</a></h4><p>The simplest way to use Logrus is simply the package-level exported logger:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>

<span style=color:#f92672>import</span> (
  <span style=color:#a6e22e>log</span> <span style=color:#e6db74>&#34;github.com/sirupsen/logrus&#34;</span>
)

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
  <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithFields</span>(<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fields</span>{
    <span style=color:#e6db74>&#34;animal&#34;</span>: <span style=color:#e6db74>&#34;walrus&#34;</span>,
  }).<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;A walrus appears&#34;</span>)
}
</code></pre></div><p>Note that it&rsquo;s completely api-compatible with the stdlib logger, so you can
replace your <code>log</code> imports everywhere with <code>log "github.com/sirupsen/logrus"</code>
and you&rsquo;ll now have the flexibility of Logrus. You can customize it all you
want:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>

<span style=color:#f92672>import</span> (
  <span style=color:#e6db74>&#34;os&#34;</span>
  <span style=color:#a6e22e>log</span> <span style=color:#e6db74>&#34;github.com/sirupsen/logrus&#34;</span>
)

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>init</span>() {
  <span style=color:#75715e>// Log as JSON instead of the default ASCII formatter.
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>SetFormatter</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>JSONFormatter</span>{})

  <span style=color:#75715e>// Output to stdout instead of the default stderr
</span><span style=color:#75715e></span>  <span style=color:#75715e>// Can be any io.Writer, see below for File example
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>SetOutput</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>)

  <span style=color:#75715e>// Only log the warning severity or above.
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>SetLevel</span>(<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WarnLevel</span>)
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
  <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithFields</span>(<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fields</span>{
    <span style=color:#e6db74>&#34;animal&#34;</span>: <span style=color:#e6db74>&#34;walrus&#34;</span>,
    <span style=color:#e6db74>&#34;size&#34;</span>:   <span style=color:#ae81ff>10</span>,
  }).<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;A group of walrus emerges from the ocean&#34;</span>)

  <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithFields</span>(<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fields</span>{
    <span style=color:#e6db74>&#34;omg&#34;</span>:    <span style=color:#66d9ef>true</span>,
    <span style=color:#e6db74>&#34;number&#34;</span>: <span style=color:#ae81ff>122</span>,
  }).<span style=color:#a6e22e>Warn</span>(<span style=color:#e6db74>&#34;The group&#39;s number increased tremendously!&#34;</span>)

  <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithFields</span>(<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fields</span>{
    <span style=color:#e6db74>&#34;omg&#34;</span>:    <span style=color:#66d9ef>true</span>,
    <span style=color:#e6db74>&#34;number&#34;</span>: <span style=color:#ae81ff>100</span>,
  }).<span style=color:#a6e22e>Fatal</span>(<span style=color:#e6db74>&#34;The ice breaks!&#34;</span>)

  <span style=color:#75715e>// A common pattern is to re-use fields between logging statements by re-using
</span><span style=color:#75715e></span>  <span style=color:#75715e>// the logrus.Entry returned from WithFields()
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>contextLogger</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithFields</span>(<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fields</span>{
    <span style=color:#e6db74>&#34;common&#34;</span>: <span style=color:#e6db74>&#34;this is a common field&#34;</span>,
    <span style=color:#e6db74>&#34;other&#34;</span>: <span style=color:#e6db74>&#34;I also should be logged always&#34;</span>,
  })

  <span style=color:#a6e22e>contextLogger</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;I&#39;ll be logged with common and other field&#34;</span>)
  <span style=color:#a6e22e>contextLogger</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;Me too&#34;</span>)
}
</code></pre></div><p>For more advanced usage such as logging to multiple locations from the same
application, you can also create an instance of the <code>logrus</code> Logger:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>

<span style=color:#f92672>import</span> (
  <span style=color:#e6db74>&#34;os&#34;</span>
  <span style=color:#e6db74>&#34;github.com/sirupsen/logrus&#34;</span>
)

<span style=color:#75715e>// Create a new instance of the logger. You can have any number of instances.
</span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>log</span> = <span style=color:#a6e22e>logrus</span>.<span style=color:#a6e22e>New</span>()

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
  <span style=color:#75715e>// The API for setting attributes is a little different than the package level
</span><span style=color:#75715e></span>  <span style=color:#75715e>// exported logger. See Godoc.
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Out</span> = <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>

  <span style=color:#75715e>// You could set this to any `io.Writer` such as a file
</span><span style=color:#75715e></span>  <span style=color:#75715e>// file, err := os.OpenFile(&#34;logrus.log&#34;, os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0666)
</span><span style=color:#75715e></span>  <span style=color:#75715e>// if err == nil {
</span><span style=color:#75715e></span>  <span style=color:#75715e>//  log.Out = file
</span><span style=color:#75715e></span>  <span style=color:#75715e>// } else {
</span><span style=color:#75715e></span>  <span style=color:#75715e>//  log.Info(&#34;Failed to log to file, using default stderr&#34;)
</span><span style=color:#75715e></span>  <span style=color:#75715e>// }
</span><span style=color:#75715e></span>
  <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithFields</span>(<span style=color:#a6e22e>logrus</span>.<span style=color:#a6e22e>Fields</span>{
    <span style=color:#e6db74>&#34;animal&#34;</span>: <span style=color:#e6db74>&#34;walrus&#34;</span>,
    <span style=color:#e6db74>&#34;size&#34;</span>:   <span style=color:#ae81ff>10</span>,
  }).<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;A group of walrus emerges from the ocean&#34;</span>)
}
</code></pre></div><h4 id=fields>Fields
<a class=anchor href=#fields>#</a></h4><p>Logrus encourages careful, structured logging through logging fields instead of
long, unparseable error messages. For example, instead of: <code>log.Fatalf("Failed to send event %s to topic %s with key %d")</code>, you should log the much more
discoverable:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithFields</span>(<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fields</span>{
  <span style=color:#e6db74>&#34;event&#34;</span>: <span style=color:#a6e22e>event</span>,
  <span style=color:#e6db74>&#34;topic&#34;</span>: <span style=color:#a6e22e>topic</span>,
  <span style=color:#e6db74>&#34;key&#34;</span>: <span style=color:#a6e22e>key</span>,
}).<span style=color:#a6e22e>Fatal</span>(<span style=color:#e6db74>&#34;Failed to send event&#34;</span>)
</code></pre></div><p>We&rsquo;ve found this API forces you to think about logging in a way that produces
much more useful logging messages. We&rsquo;ve been in countless situations where just
a single added field to a log statement that was already there would&rsquo;ve saved us
hours. The <code>WithFields</code> call is optional.</p><p>In general, with Logrus using any of the <code>printf</code>-family functions should be
seen as a hint you should add a field, however, you can still use the
<code>printf</code>-family functions with Logrus.</p><h4 id=default-fields>Default Fields
<a class=anchor href=#default-fields>#</a></h4><p>Often it&rsquo;s helpful to have fields <em>always</em> attached to log statements in an
application or parts of one. For example, you may want to always log the
<code>request_id</code> and <code>user_ip</code> in the context of a request. Instead of writing
<code>log.WithFields(log.Fields{"request_id": request_id, "user_ip": user_ip})</code> on
every line, you can create a <code>logrus.Entry</code> to pass around instead:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>requestLogger</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithFields</span>(<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fields</span>{<span style=color:#e6db74>&#34;request_id&#34;</span>: <span style=color:#a6e22e>request_id</span>, <span style=color:#e6db74>&#34;user_ip&#34;</span>: <span style=color:#a6e22e>user_ip</span>})
<span style=color:#a6e22e>requestLogger</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;something happened on that request&#34;</span>) <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>will</span> <span style=color:#a6e22e>log</span> <span style=color:#a6e22e>request_id</span> <span style=color:#a6e22e>and</span> <span style=color:#a6e22e>user_ip</span>
<span style=color:#a6e22e>requestLogger</span>.<span style=color:#a6e22e>Warn</span>(<span style=color:#e6db74>&#34;something not great happened&#34;</span>)
</code></pre></div><h4 id=hooks>Hooks
<a class=anchor href=#hooks>#</a></h4><p>You can add hooks for logging levels. For example to send errors to an exception
tracking service on <code>Error</code>, <code>Fatal</code> and <code>Panic</code>, info to StatsD or log to
multiple places simultaneously, e.g. syslog.</p><p>Logrus comes with
<a href=hooks/>built-in hooks</a>. Add those, or your custom hook, in
<code>init</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>import</span> (
  <span style=color:#a6e22e>log</span> <span style=color:#e6db74>&#34;github.com/sirupsen/logrus&#34;</span>
  <span style=color:#e6db74>&#34;gopkg.in/gemnasium/logrus-airbrake-hook.v2&#34;</span> <span style=color:#75715e>// the package is named &#34;airbrake&#34;
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>logrus_syslog</span> <span style=color:#e6db74>&#34;github.com/sirupsen/logrus/hooks/syslog&#34;</span>
  <span style=color:#e6db74>&#34;log/syslog&#34;</span>
)

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>init</span>() {

  <span style=color:#75715e>// Use the Airbrake hook to report errors that have Error severity or above to
</span><span style=color:#75715e></span>  <span style=color:#75715e>// an exception tracker. You can create custom hooks, see the Hooks section.
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>AddHook</span>(<span style=color:#a6e22e>airbrake</span>.<span style=color:#a6e22e>NewHook</span>(<span style=color:#ae81ff>123</span>, <span style=color:#e6db74>&#34;xyz&#34;</span>, <span style=color:#e6db74>&#34;production&#34;</span>))

  <span style=color:#a6e22e>hook</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>logrus_syslog</span>.<span style=color:#a6e22e>NewSyslogHook</span>(<span style=color:#e6db74>&#34;udp&#34;</span>, <span style=color:#e6db74>&#34;localhost:514&#34;</span>, <span style=color:#a6e22e>syslog</span>.<span style=color:#a6e22e>LOG_INFO</span>, <span style=color:#e6db74>&#34;&#34;</span>)
  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;Unable to connect to local syslog daemon&#34;</span>)
  } <span style=color:#66d9ef>else</span> {
    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>AddHook</span>(<span style=color:#a6e22e>hook</span>)
  }
}
</code></pre></div><p>Note: Syslog hook also support connecting to local syslog (Ex. &ldquo;/dev/log&rdquo; or &ldquo;/var/run/syslog&rdquo; or &ldquo;/var/run/log&rdquo;). For the detail, please check the
<a href=hooks/syslog/README>syslog hook README</a>.</p><p>A list of currently known service hooks can be found in this wiki
<a href=https://github.com/sirupsen/logrus/wiki/Hooks>page</a></p><h4 id=level-logging>Level logging
<a class=anchor href=#level-logging>#</a></h4><p>Logrus has seven logging levels: Trace, Debug, Info, Warning, Error, Fatal and Panic.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Trace</span>(<span style=color:#e6db74>&#34;Something very low level.&#34;</span>)
<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Debug</span>(<span style=color:#e6db74>&#34;Useful debugging information.&#34;</span>)
<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;Something noteworthy happened!&#34;</span>)
<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Warn</span>(<span style=color:#e6db74>&#34;You should probably take a look at this.&#34;</span>)
<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;Something failed but I&#39;m not quitting.&#34;</span>)
<span style=color:#75715e>// Calls os.Exit(1) after logging
</span><span style=color:#75715e></span><span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#e6db74>&#34;Bye.&#34;</span>)
<span style=color:#75715e>// Calls panic() after logging
</span><span style=color:#75715e></span><span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Panic</span>(<span style=color:#e6db74>&#34;I&#39;m bailing.&#34;</span>)
</code></pre></div><p>You can set the logging level on a <code>Logger</code>, then it will only log entries with
that severity or anything above it:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#75715e>// Will log anything that is info or above (warn, error, fatal, panic). Default.
</span><span style=color:#75715e></span><span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>SetLevel</span>(<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>InfoLevel</span>)
</code></pre></div><p>It may be useful to set <code>log.Level = logrus.DebugLevel</code> in a debug or verbose
environment if your application has that.</p><h4 id=entries>Entries
<a class=anchor href=#entries>#</a></h4><p>Besides the fields added with <code>WithField</code> or <code>WithFields</code> some fields are
automatically added to all logging events:</p><ol><li><code>time</code>. The timestamp when the entry was created.</li><li><code>msg</code>. The logging message passed to <code>{Info,Warn,Error,Fatal,Panic}</code> after
the <code>AddFields</code> call. E.g. <code>Failed to send event.</code></li><li><code>level</code>. The logging level. E.g. <code>info</code>.</li></ol><h4 id=environments>Environments
<a class=anchor href=#environments>#</a></h4><p>Logrus has no notion of environment.</p><p>If you wish for hooks and formatters to only be used in specific environments,
you should handle that yourself. For example, if your application has a global
variable <code>Environment</code>, which is a string representation of the environment you
could do:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>import</span> (
  <span style=color:#a6e22e>log</span> <span style=color:#e6db74>&#34;github.com/sirupsen/logrus&#34;</span>
)

<span style=color:#a6e22e>init</span>() {
  <span style=color:#75715e>// do something here to set environment depending on an environment variable
</span><span style=color:#75715e></span>  <span style=color:#75715e>// or command-line flag
</span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>Environment</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;production&#34;</span> {
    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>SetFormatter</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>JSONFormatter</span>{})
  } <span style=color:#66d9ef>else</span> {
    <span style=color:#75715e>// The TextFormatter is default, you don&#39;t actually have to do this.
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>SetFormatter</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>TextFormatter</span>{})
  }
}
</code></pre></div><p>This configuration is how <code>logrus</code> was intended to be used, but JSON in
production is mostly only useful if you do log aggregation with tools like
Splunk or Logstash.</p><h4 id=formatters>Formatters
<a class=anchor href=#formatters>#</a></h4><p>The built-in logging formatters are:</p><ul><li><code>logrus.TextFormatter</code>. Logs the event in colors if stdout is a tty, otherwise
without colors.<ul><li><em>Note:</em> to force colored output when there is no TTY, set the <code>ForceColors</code>
field to <code>true</code>. To force no colored output even if there is a TTY set the
<code>DisableColors</code> field to <code>true</code>. For Windows, see
<a href=https://github.com/mattn/go-colorable>github.com/mattn/go-colorable</a>.</li><li>When colors are enabled, levels are truncated to 4 characters by default. To disable
truncation set the <code>DisableLevelTruncation</code> field to <code>true</code>.</li><li>When outputting to a TTY, it&rsquo;s often helpful to visually scan down a column where all the levels are the same width. Setting the <code>PadLevelText</code> field to <code>true</code> enables this behavior, by adding padding to the level text.</li><li>All options are listed in the
<a href=https://godoc.org/github.com/sirupsen/logrus#TextFormatter>generated docs</a>.</li></ul></li><li><code>logrus.JSONFormatter</code>. Logs fields as JSON.<ul><li>All options are listed in the
<a href=https://godoc.org/github.com/sirupsen/logrus#JSONFormatter>generated docs</a>.</li></ul></li></ul><p>Third party logging formatters:</p><ul><li><a href=https://github.com/joonix/log><code>FluentdFormatter</code></a>. Formats entries that can be parsed by Kubernetes and Google Container Engine.</li><li><a href=https://github.com/fabienm/go-logrus-formatters><code>GELF</code></a>. Formats entries so they comply to Graylog&rsquo;s
<a href=http://docs.graylog.org/en/2.4/pages/gelf.html>GELF 1.1 specification</a>.</li><li><a href=https://github.com/bshuster-repo/logrus-logstash-hook><code>logstash</code></a>. Logs fields as
<a href=http://logstash.net>Logstash</a> Events.</li><li><a href=https://github.com/x-cray/logrus-prefixed-formatter><code>prefixed</code></a>. Displays log entry source along with alternative layout.</li><li><a href=https://github.com/aybabtme/logzalgo><code>zalgo</code></a>. Invoking the Power of Zalgo.</li><li><a href=https://github.com/antonfisher/nested-logrus-formatter><code>nested-logrus-formatter</code></a>. Converts logrus fields to a nested structure.</li><li><a href=https://github.com/zput/zxcTool><code>powerful-logrus-formatter</code></a>. get fileName, log&rsquo;s line number and the latest function&rsquo;s name when print log; Sava log to files.</li><li><a href=https://github.com/nolleh/caption_json_formatter><code>caption-json-formatter</code></a>. logrus&rsquo;s message json formatter with human-readable caption added.</li></ul><p>You can define your formatter by implementing the <code>Formatter</code> interface,
requiring a <code>Format</code> method. <code>Format</code> takes an <code>*Entry</code>. <code>entry.Data</code> is a
<code>Fields</code> type (<code>map[string]interface{}</code>) with all your fields as well as the
default ones (see Entries section above):</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>MyJSONFormatter</span> <span style=color:#66d9ef>struct</span> {
}

<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>SetFormatter</span>(new(<span style=color:#a6e22e>MyJSONFormatter</span>))

<span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>f</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>MyJSONFormatter</span>) <span style=color:#a6e22e>Format</span>(<span style=color:#a6e22e>entry</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Entry</span>) ([]<span style=color:#66d9ef>byte</span>, <span style=color:#66d9ef>error</span>) {
  <span style=color:#75715e>// Note this doesn&#39;t include Time, Level and Message which are available on
</span><span style=color:#75715e></span>  <span style=color:#75715e>// the Entry. Consult `godoc` on information about those fields or read the
</span><span style=color:#75715e></span>  <span style=color:#75715e>// source of the official loggers.
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>serialized</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Marshal</span>(<span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>Data</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;Failed to marshal fields to JSON, %w&#34;</span>, <span style=color:#a6e22e>err</span>)
    }
  <span style=color:#66d9ef>return</span> append(<span style=color:#a6e22e>serialized</span>, <span style=color:#e6db74>&#39;\n&#39;</span>), <span style=color:#66d9ef>nil</span>
}
</code></pre></div><h4 id=logger-as-an-iowriter>Logger as an <code>io.Writer</code>
<a class=anchor href=#logger-as-an-iowriter>#</a></h4><p>Logrus can be transformed into an <code>io.Writer</code>. That writer is the end of an <code>io.Pipe</code> and it is your responsibility to close it.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>w</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Writer</span>()
<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Close</span>()

<span style=color:#a6e22e>srv</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Server</span>{
    <span style=color:#75715e>// create a stdlib log.Logger that writes to
</span><span style=color:#75715e></span>    <span style=color:#75715e>// logrus.Logger.
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>ErrorLog</span>: <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#ae81ff>0</span>),
}
</code></pre></div><p>Each line written to that writer will be printed the usual way, using formatters
and hooks. The level for those entries is <code>info</code>.</p><p>This means that we can override the standard library logger easily:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>logger</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>logrus</span>.<span style=color:#a6e22e>New</span>()
<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Formatter</span> = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>logrus</span>.<span style=color:#a6e22e>JSONFormatter</span>{}

<span style=color:#75715e>// Use logrus for standard log output
</span><span style=color:#75715e>// Note that `log` here references stdlib&#39;s log
</span><span style=color:#75715e>// Not logrus imported under the name `log`.
</span><span style=color:#75715e></span><span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>SetOutput</span>(<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Writer</span>())
</code></pre></div><h4 id=rotation>Rotation
<a class=anchor href=#rotation>#</a></h4><p>Log rotation is not provided with Logrus. Log rotation should be done by an
external program (like <code>logrotate(8)</code>) that can compress and delete old log
entries. It should not be a feature of the application-level logger.</p><h4 id=tools>Tools
<a class=anchor href=#tools>#</a></h4><table><thead><tr><th>Tool</th><th>Description</th></tr></thead><tbody><tr><td><a href=https://github.com/gogap/logrus_mate>Logrus Mate</a></td><td>Logrus mate is a tool for Logrus to manage loggers, you can initial logger&rsquo;s level, hook and formatter by config file, the logger will be generated with different configs in different environments.</td></tr><tr><td><a href=https://github.com/heirko/go-contrib/tree/master/logrusHelper>Logrus Viper Helper</a></td><td>An Helper around Logrus to wrap with spf13/Viper to load configuration with fangs! And to simplify Logrus configuration use some behavior of
<a href=https://github.com/gogap/logrus_mate>Logrus Mate</a>.
<a href=https://github.com/heirko/iris-contrib/blob/master/middleware/logrus-logger/example>sample</a></td></tr></tbody></table><h4 id=testing>Testing
<a class=anchor href=#testing>#</a></h4><p>Logrus has a built in facility for asserting the presence of log messages. This is implemented through the <code>test</code> hook and provides:</p><ul><li>decorators for existing logger (<code>test.NewLocal</code> and <code>test.NewGlobal</code>) which basically just adds the <code>test</code> hook</li><li>a test logger (<code>test.NewNullLogger</code>) that just records log messages (and does not output any):</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>import</span>(
  <span style=color:#e6db74>&#34;github.com/sirupsen/logrus&#34;</span>
  <span style=color:#e6db74>&#34;github.com/sirupsen/logrus/hooks/test&#34;</span>
  <span style=color:#e6db74>&#34;github.com/stretchr/testify/assert&#34;</span>
  <span style=color:#e6db74>&#34;testing&#34;</span>
)

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestSomething</span>(<span style=color:#a6e22e>t</span><span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>){
  <span style=color:#a6e22e>logger</span>, <span style=color:#a6e22e>hook</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>test</span>.<span style=color:#a6e22e>NewNullLogger</span>()
  <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;Helloerror&#34;</span>)

  <span style=color:#a6e22e>assert</span>.<span style=color:#a6e22e>Equal</span>(<span style=color:#a6e22e>t</span>, <span style=color:#ae81ff>1</span>, len(<span style=color:#a6e22e>hook</span>.<span style=color:#a6e22e>Entries</span>))
  <span style=color:#a6e22e>assert</span>.<span style=color:#a6e22e>Equal</span>(<span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>logrus</span>.<span style=color:#a6e22e>ErrorLevel</span>, <span style=color:#a6e22e>hook</span>.<span style=color:#a6e22e>LastEntry</span>().<span style=color:#a6e22e>Level</span>)
  <span style=color:#a6e22e>assert</span>.<span style=color:#a6e22e>Equal</span>(<span style=color:#a6e22e>t</span>, <span style=color:#e6db74>&#34;Helloerror&#34;</span>, <span style=color:#a6e22e>hook</span>.<span style=color:#a6e22e>LastEntry</span>().<span style=color:#a6e22e>Message</span>)

  <span style=color:#a6e22e>hook</span>.<span style=color:#a6e22e>Reset</span>()
  <span style=color:#a6e22e>assert</span>.<span style=color:#a6e22e>Nil</span>(<span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>hook</span>.<span style=color:#a6e22e>LastEntry</span>())
}
</code></pre></div><h4 id=fatal-handlers>Fatal handlers
<a class=anchor href=#fatal-handlers>#</a></h4><p>Logrus can register one or more functions that will be called when any <code>fatal</code>
level message is logged. The registered handlers will be executed before
logrus performs an <code>os.Exit(1)</code>. This behavior may be helpful if callers need
to gracefully shutdown. Unlike a <code>panic("Something went wrong...")</code> call which can be intercepted with a deferred <code>recover</code> a call to <code>os.Exit(1)</code> can not be intercepted.</p><pre><code>...
handler := func() {
  // gracefully shutdown something...
}
logrus.RegisterExitHandler(handler)
...
</code></pre><h4 id=thread-safety>Thread safety
<a class=anchor href=#thread-safety>#</a></h4><p>By default, Logger is protected by a mutex for concurrent writes. The mutex is held when calling hooks and writing logs.
If you are sure such locking is not needed, you can call logger.SetNoLock() to disable the locking.</p><p>Situation when locking is not needed includes:</p><ul><li><p>You have no hooks registered, or hooks calling is already thread-safe.</p></li><li><p>Writing to logger.Out is already thread-safe, for example:</p><ol><li><p>logger.Out is protected by locks.</p></li><li><p>logger.Out is an os.File handler opened with <code>O_APPEND</code> flag, and every write is smaller than 4k. (This allows multi-thread/multi-process writing)</p><p>(Refer to <a href=http://www.notthewizard.com/2014/06/17/are-files-appends-really-atomic/>http://www.notthewizard.com/2014/06/17/are-files-appends-really-atomic/</a>)</p></li></ol></li></ul></article><div class="book-footer justify-between"></div><hr style=height:1px;background:var(--gray-200)><br><p>本图书由<a href=https://github.com/minibear2333>小熊</a>©2021 版权所有，<a href=https://golang.coding3min.com/>所有文章</a>采用<a href=https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh>知识署名-非商业性使用-禁止演绎 4.0 国际</a>进行许可。</p><div style=text-align:center><p><img width=70% style=width:70%;height:70%;!important src=https://coding3min.oss-accelerate.aliyuncs.com/2021/06/24/qrcode.png></p></div><script src=https://utteranc.es/client.js repo=minibear2333/blog-comment issue-term=title theme=github-light crossorigin=anonymous async></script><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/golang-minibear2333/golang/edit/master/./1.base/1.3-go-mod/vendor/github.com/sirupsen/logrus/README.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li></li></ul></li></ul></nav></div></aside></main></body></html>